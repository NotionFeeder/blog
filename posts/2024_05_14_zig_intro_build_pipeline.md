---
title: Using Zig for a C/C++ build pipeline
tags: [Infra, Zig]
date: 2024-05-14
summary: |
  Introduction on a series of blog posts around using Zig to build C/C++ projects.
---


> Generated by [NotionFeeder](https://notionfeeder.com/) ðŸ“¢
>

# Introduction

This will be a series of posts about using Zig to build legacy codebases written in C/C++ with Make/CMake. It will introduce only a few Zig concepts, so no prior knowledge of the language is necessary.

I discovered this approach through an article on the Uber blog ([you can read it here](https://www.uber.com/en-FR/blog/bootstrapping-ubers-infrastructure-on-arm64-with-zig/)). It intrigued me as I'd become increasingly frustrated with Make/CMake.

Since there are many concepts and tips I'd like to share, I've decided to divide the content into multiple short posts instead of one long one.

# One tool to build them all

Once upon a time, the C language was created. Then came Linux, and a whole ecosystem started to grow. But we all know how that story goes. TL;DR: C became hugely popular, and its sibling C++ followed as a helpful addition. With them came Make and CMake, powerful tools that changed how we build software.

As of now, almost all projects involving C/C++ use Make/CMake as their main build tool. It is widely used and has been indispensable for over two decades.

# The CMake problem

While I'm not an expert on the topic, I can identify some limitations based on my experience using it for a few projects:

- Fragmentation: There are numerous functions that essentially do the same thing but with slight variations. This makes it challenging for newcomers and interpreting manifests can be difficult depending on their creation date and the applicability of modern features.
- Syntax: CMake uses a blend of procedural and declarative language with a unique syntax, which requires learning. Although this may be a carryover from the older Make approach, it complicates finding relevant documentation and debugging.
- Dependency management: While there are ways to download remote code with CMake, it lacks comprehensive dependency management capabilities for downloading and compiling dependency trees.

Despite these issues, CMake is a valuable tool relative to its era. The shortcomings I've outlined are mainly in comparison to contemporary tooling which didn't exist when CMake was created. I think Zig has build on top of this and delivered a different approach which I find easier to deal with.

# The Zig build system

It's impressive how a new language addresses the problem of an entire ecosystem, and the outcome is truly amazing. A big kudos to the Ziglang community for delivering a build toolchain, as well as a C/C++ compiler (and linker) alongside their own language.

I particularly appreciate that the build system is procedural, not declarative. This approach simplifies the handling of corner cases. The system also offers numerous hooks through configurable command line flags, something that's difficult to achieve with `make`, for example.

Additionally, it includes a package manager that can pull remote code/releases. This manager can even fetch code and make it available for compilation without the need for a `build.zig` file (more on this later).

# Other resources

I used multiple resources to write about this topic, and I'll share a few here. In my posts, I aim to introduce new concepts as well as revisit and explain previously discussed ones.

Here are some of the resources:

- An Uber engineering blog entry, already referenced in the introduction: [Bootstrapping Uber's Infrastructure on ARM64 with Zig](https://www.uber.com/en-FR/blog/bootstrapping-ubers-infrastructure-on-arm64-with-zig/).
- The first blog post I read about Zig's ability to replace Make/CMake: [Make Zig Your C/C++ Build System](https://zig.news/kristoff/make-zig-your-c-c-build-system-28g5).
- [Andrew Kelley's Github profile](https://github.com/andrewrk), which contains several repositories with C projects packaged through Zig, as well as many interesting code bases:
    - [ffmpeg](https://github.com/andrewrk/ffmpeg)
    - [libz](https://github.com/andrewrk/libz)

# Disclaimer

Zig has not yet reached version 1.0, with many elements still in flux and API changes occurring between releases. Be cautious when using it, keeping these considerations in mind.
